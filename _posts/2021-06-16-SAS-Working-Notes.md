---
layout: post
title: SAS Working Notes
subtitle: last update 2021-06-29
bigimg:
- "/img/sas.png" : "SAS Printscreen"
---


This blog is used to record my daily working notes related to SAS. 

# Table

- [JUNE](#june)
- [JULY](#july)

# June

## _20210616_

I have to admit that an actual industrial project is truly different from what I expected, when I was a new graduate. Anothing truth is, although the procedure is far more complex, the real technical part, in my opinion, is still the same.

**CALL SYMPUT**: Assigns a value produced in a DATA step to a macro variable.

```
CALL SYMPUT(macro-variable, value);
```

[Link](https://documentation.sas.com/doc/en/pgmsascdc/9.4_3.5/mcrolref/p09y28i2d1kn8qn1p1icxchz37p3.htm)

Today is the first time that G (one of my friend) truly experienced the workplace PUA, which is a really really really terrible experience. Here is his experience in the past few days:

**Story 1**

G was assigned with a dataset at 4 pm last Thursday, then the next day at 11 am, his manager came to ask whether he finished or not, G said no; then at 2 pm, his manager came and asked again, but G was still working on it at that time, which is the truth, because that's his first real project in that company, and as a new employee, G was not familiar with the whole bunch of files and data standards! 

After G told his manager that he was still working on that dataset, his manager asked him: 

"why it takes you two days to finish the first step?" 

"Are you working?" 

_At that time, G's inner thought is: "WTF? You gave it to me yesterday at 4 pm :) And you never told me you want this dataset so hastily! WITHIN HALF OF A DAY! Are you kidding me? FOR A NEW EMPLOYEE! WITHOUT INSTRUCTIONS?"_

But bowing to the reality, G's true answer is:

"Sorry, I was working on the sandbox exercise before. And I just got this project at 4 pm yesterday."

"I will spend more time on it."

Guess what happened next? His manager told G to finish this dataset by the end of day, which is understandable, but this manager's original message is:

"SPEND ALL YOUR TIME ON IT NOW. GET A DRAFT TODAY." 

The much more ridiculous thing is, when G submitted the work at 5:30 pm (he was expected to leave at 5 pm) and came back after dinner, he found his manager skyped him at 5:45 pm asking his phone number. 

_There is more than that, but I guess G is too tired to share his story with me anymore._

_"Keep learning" Might He think._

_Grow faster, grow stronger._

## _20210617_

**%sysfunc()**: Execute SAS functions or user-written functions.

```
%SYSFUNC(function(argument(s))<, format>);
```

where `function` is the name of the function to execute. This function can be a SAS function, a function written with SAS/TOOLKIT software, or a function created using the FCMP Procedure in Base SAS Procedures Guide. The function **_CANNOT_** be a macro function. `format` is an optional format to apply to the result of function. This format can be provided by SAS, generated by PROC FORMAT, or created with SAS/TOOLKIT. There is no default value for format. If you do not specify a format, the SAS macro facility does not perform a format operation on the result and uses the default of the function.

**PWD**: Print Working Directory

**SYSGET**: function, returns the value of the specified operating-environment variable.

**GETOPTION**: function, returns the value of a SAS system or graphics option.

**%EVAL**: Evaluates arithmetic and logical expressions using integer arithmetic. 

%EVAL operates by converting its argument from a character value to a numeric or logical expression. Then, it performs the evaluation. Finally, %EVAL converts the result back to a character value and returns that value.

**libname ... INENCODING=, OUTENCODING=**: The INENCODING= option is used to read SAS data sets in the SAS library. The OUTENCODING= option is used to write SAS data sets in the SAS library.

**OPTIONS MISSING = System option**: Specifies the character to print for missing numeric values.

**OPTIONS NONUMBER**: Suppress page numbers.

**OPTIONS NOTES**: Specifies whether notes are written to the SAS log.

**OPTIONS SOURCE**: Specifies whether SAS writes source statements to the SAS log.

Similarly for arguments including **mprint** and **mlogic**.

**OPTIONS FMTSEARCH**: Specifies the order in which format catalogs are searched.

**OPTIONS SASAUTOS**: Specifies the location of one or more autocall libraries.

```
options ps = &stndrdps ls =&stndrdls nodate center nonumber missing = " ";
options notes source mprint mlogic symbolgen=yes msglevel=i  validvarname=v7;
options fmtsearch=(raw tab ana) sasautos = ('!SASROOT/sasautos/' "&wkdir/macros/" "&wkdir/macros/utilities/");
```


## _20210618_

Remember **CALL SYMPUT**: Assigns a value produced in a DATA step to a macro variable. 

```
CALL SYMPUT(macro-variable, value);
```

Now, **CALL SYMPUTX**: Assigns a value to a macro variable, and removes both leading and trailing blanks.

```
CALL SYMPUTX(macro-variable, value <, symbol-table>);
```

which is doing the same work as 

```
call symput(macro, trim(left(value)));
```

**NOBS**: a SAS automatic variable which contains the number of records in the data set named in the set statement.

```
data _NULL_;
	if 0 then set sashelp.class nobs=n;
	call symputx('nrows',n);
	stop;
run;
%put nobs=&nrows;
```

**PUT**: Use the PUT function to convert a numeric value to a character value. You cannot use the PUT function to directly change the type of variable in a data set from numeric to character. However, you can create a new character variable as the result of the PUT function. 

**INPUT**: The INPUT function enables you to convert the value of source by using a specified informat. The informat determines whether the result is numeric or character. Use INPUT to convert character values to numeric values or other character values.

```
var1 = PUT(source, format.);
var2 = INPUT(source, <? | ??> informat.);
```

## _20210621_

Sick.

## _20210622_

**best.**: SAS chooses the best notation when a format is not specified for writing a numeric value. For example,
```
var = put(x, best.);
```

**_name_**: appears when using a tranpose step, so let's talk about the transpose step.

## _20210623_

**PROC TRANSPOSE**: 

**STRIP**: Returns a character string with all leading and trailing blanks removed.

**Put proc sort into a data step**

```
data ...;

statements;

proc sort; 
by ...;

run;
```

## _20210624_

**index(source, string);**: Searches a character expression for a string of characters, and returns the position of the string's first character for the first occurrence of the string.

## _20210625_

SO FAR SO GOOD.

## _20210628_

**Array**: a list of variables(columns) in SAS. See [here](https://linyiguo96.github.io//2021-04-28-SAS-Advanced-Study-Notes/#array).

**PROC COMPARE**: Compares the contents of two SAS data sets, selected variables in different data sets, or variables within the same data set. See [here](https://documentation.sas.com/doc/en/pgmsascdc/9.4_3.5/proc/n0c1y14wyd3u7yn1dmfcpaejllsn.htm).

```
libname proclib 'SAS-library';
options nodate pageno=1 linesize=80 pagesize=40;
proc compare base=proclib.one compare=proclib.two nosummary;
   var gr1;
   with gr2;
   title 'Comparison of Variables in Different Data Sets';
run;
```

## _20210629_

I have been struggled with three variables for a whole day, they are VISIT, VISITNUM and VISITDY. I am still confused with how to program these three variables when I wrote this line. There are several documents/sheets involving, I need to refer to different document from time to time... And then I lost myself. It could be something wrong with the guide, or more possibly, I sucked. 

Okay, anyway, let me reorganize my mind. I have several resoueces here: 
- The original dataset sheet (IE/PE), which requires me to add these three variables
- The METHODS sheet told me how to program VISIT
- The (TV) sheet should be referred to generate VISIT
- Some other datasets including TV and SV

Now, when I worked on the VISITNUM & VISITDY, the programming notes said "Assign from MAPPING.TV.VISITNUM for Schedule visits for Unschedule visits mapp from MAPPING.SV.VISITNUM". So I had my first question here, how could I tell whether it is schedule or not? I didn't see any variable regarding this, if my memory is correct...

Okay let's talk about the VISIT variable, like I said, the METHODS sheet is used to program VISIT, but I met the same problem like I mentioned above, what's schedule and unscheduled visit?

Besides this, it said "Refer to (TV), set VISIT from FOLDERNAME and INSTANCENAME. " Then I got confused again... I guess I know what it means generally but I can't be totally sure about my guess. In a word, I am not very sure about how to assign values to the VISIT variable. 

Now I am waiting for my manager's feedback, hopefully he could help me out.

One of the most challenging things I met so far is the meaning of various terms and abbreviations... Because the project is related to clinical research, it always involves with kinds of trials and treatments. To some extent, those abbreviations bring much more problems for me. Oh, the standard could be referred to CDISC (Clinical Data Interchange Standards Consortium).


## _20210630_

Finally finished the problem I mentioned above... Next step is to work on the CV and PR...

This is the first time that I don't have an example even the raw data when dealing with a sdtm dataset. I guess I need to spend more time on them for the moment.


# July

## _20210701_

Today is Canada Day, as well as CPC(Communist Party of China) Founding Day.

## _20210702_

Jokes on myself. The CV(Cardiovascular System) dataset is based on the raw ECHO(Echocardiogram/MUGA) instead of cv (actually there is no raw data called CV.)

Until just now I figured out several variables only. The worse thing is, the person who are expected to help and lead me with the programming rejected to provide his help. And the person he assigned to me for asking is in a totally opposite working time zone. Well, what a lucky dog as i am!

**in operator**: note add `,` among values, such as `x in ('a', 'b', 'c');`.

## _20210705_

Now it is 3:40 am, and I am working. Yes, because I want to finish these two datasets, but until now, I am still confused about the specs in the document.

And again, the worst thing is, I basically have no one to ask. Honestly, I feel very very very terrible now. These whole bunch of things makes me feel like an idiot. 

------------------------------------

I was stuck at somewhere early this morning, around 5 am I guess. Then just now, after digging for a while, I found this dataset is not defined in the _attrib_ document, which is used to add labels, order and normalize variables. See, this is another tricky point as well as one of the hardest things in my work, because it's not guaranteed that everyone's work is accurate 100%, but usually everyone's work is dependent on others (although no one rely on mine so far). 

Anyway, as a REMINDER: when something wrong with the **%m_attr()** step in your program but no errors happened before, check the _attrib.csv_ file, some variables may be missed over there.

## _20210706_

Finally I finished those two datasets, but with the reminder from another team member, I found there are still some problems with my previous work...

Anyway, keep working! BTW, to have a chat with that teammate and don't bother her too much, I worked at midnight again from 11 pm to 12:45 am (July 7th)... I guess next time I should contact her earlier, better before her lunch time. But the result is good. Here is what I learned:

In a raw SDTM dataset, there could be some _datetime_ variables such as **--STDAT** and **--STDAT_RAW** (usually the former one is numeric/datetime type and the latter is character), and in the spec, the programming notes for a **--STDTC** variable could be "_set to --STDAT_". 

**Note**, this doesn't mean you are actually expected to use **--STDAT** to create the required variable, it could be **--STDAT_RAW**. Since they essentially stand for the same thing/date, so you really need to look at the macro **%miso()** and decide which variable you should go with.

## _20210707_








